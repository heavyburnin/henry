from flask import Flask, request, render_template, jsonify
from model_runner import model_runner

app = Flask(__name__)
model = model_runner()

# Serve index.html at /chat for both GET (to load UI) and POST (form submit)
@app.route("/chat", methods=["GET", "POST"])
def chat_ui():
    reply = ""
    if request.method == "POST":
        user_input = request.form.get("message", "")
        reply = model.infer(user_input)
    return render_template("index.html", reply=reply)

# Optional JSON API at /chat/api
@app.route("/chat/api", methods=["POST"])
def chat_api():
    if request.is_json:
        data = request.get_json()
        if not data or "message" not in data:
            return jsonify({"error": "Missing 'message' in JSON"}), 400
        user_input = data["message"]
        reply = model.infer(user_input)
        return jsonify({"response": reply})
    return jsonify({"error": "Expected application/json POST"}), 400

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True, use_reloader=False)

